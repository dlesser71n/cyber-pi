apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: tqakb-ingress
  namespace: tqakb-v4
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
spec:
  ingressClassName: nginx
  rules:
  - host: tqakb.local
    http:
      paths:
      # API Gateway (will be added later)
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: api-gateway
            port:
              number: 8000
      
      # Redis Stack UI
      - path: /redis
        pathType: Prefix
        backend:
          service:
            name: redis
            port:
              number: 8001
      
      # Neo4j Browser
      - path: /neo4j
        pathType: Prefix
        backend:
          service:
            name: neo4j
            port:
              number: 7474
      
      # Weaviate Console
      - path: /weaviate
        pathType: Prefix
        backend:
          service:
            name: weaviate
            port:
              number: 8080
      
      # Kafka UI (to be added)
      - path: /kafka-ui
        pathType: Prefix
        backend:
          service:
            name: kafka-ui
            port:
              number: 8080
---
# TCP Ingress for non-HTTP services
apiVersion: v1
kind: ConfigMap
metadata:
  name: tcp-services
  namespace: ingress
data:
  # Kafka
  9092: "tqakb-v4/kafka:9092"
  # Redis
  6379: "tqakb-v4/redis:6379"
  # Neo4j Bolt
  7687: "tqakb-v4/neo4j:7687"
  # Weaviate gRPC
  50051: "tqakb-v4/weaviate:50051"